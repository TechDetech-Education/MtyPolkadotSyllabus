# Minimal libp2p blockchain

```mermaid
flowchart TD
    EventType-->Swarm
    EventType-->Input
    Swarm-- Gossipsub -->PubsubEvent
    Swarm-- Mdns -->DiscoveryEvent
    PubsubEvent--> |Message|Deserialize[Deserialize Message]
    Deserialize--> |Ok|ChainUpdate[Update Chain]
    Deserialize--> |Err|LogError[Log Error]
    DiscoveryEvent--> |Discovered|AddPeer[Add Peer]
    DiscoveryEvent--> |Expired|RemovePeer[Remove Peer]
    ChainUpdate--> |Block is valid|UpdateSuccessful[Chain updated]
    ChainUpdate--> |Block is invalid|IgnoreBlock[Ignore Block]
    Input -->|create block|ChainPublish[Pubsub Publish Chain]
    Input -->|list peers|PeersList[Discovery Get Peers]
```

```mermaid
sequenceDiagram
	Alice ->> Bob: InitHandshake(p)
	Bob -->> Alice: InitHandshake(q)
	Alice ->> Bob: RespHandshake(A = q^a mod p)
	Bob -->> Alice: RespHandshake(B = q^b mod p)
	Note over Alice,Bob: S = B^a mod p = A^b mod p
```
- $p$ is *prime*
- $q$ is a *primitive root modulo* $p$
- $a$ and $b$ are random secret numbers, $a, b < p$

A *primitive root modulo* $p$ is an integer $g$ that has a special property when used as the base of exponentiation modulo `p`. Let's break down the properties of primitive roots modulo `p`:

1. **Co-prime with `p`**: A primitive root $g$ must be co-prime with $p$: $$\gcd(g, p) = 1$$This property ensures that $g$ has no common factors with $p$.

2. **Distinct powers**: When $g$ is raised to different powers modulo $p$, the resulting values are distinct residues modulo $p$: $$\forall x \in [1, p) \:\exists!\;g^{x}\;\mathrm{mod}\;p$$This property guarantees that $g$ generates a full set of residues modulo $p$ without repetition.

3. **Generator of the group**: The set of residues modulo $p$ generated by $g$ forms a cyclic group called the multiplicative group modulo $p$, denoted as $Z_p^*$. This group contains all the residues co-prime with $p$. The order of this group is $\phi(p)$, where $\phi$ represents Euler's *totient* function. A primitive root $g$ generates $Z_p^*$ as it spans all possible residues modulo $p$. $\phi(p) = |Z_p^*|$

```mermaid
sequenceDiagram
    participant Alice
    participant Bob

    Alice->>Bob: GenerateKeyPair()
    Bob->>Alice: GenerateKeyPair()
    Note over Alice, Bob: Each generates their own private/public key pair

    Alice->>Bob: SendPublicKey(Alice_PublicKey)
    Bob->>Alice: SendPublicKey(Bob_PublicKey)
    Note over Alice, Bob: Public keys are exchanged openly

    loop Secure Channel Established
        Alice->>Bob: Encrypt(SecretMessage, Bob_PublicKey)
        Bob->>Alice: Decrypt(EncryptedMessage, Bob_PrivateKey)
        Bob->>Alice: Sign(Message, Bob_PrivateKey)
        Alice->>Bob: VerifySignature(Message, Alice_PublicKey)
    end
```
